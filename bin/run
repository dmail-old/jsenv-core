#!/usr/bin/env node

var commandAPI = require('../lib/command-api/index.js');

function startCommand(params) {
    require('./node.js')(params.filename, params);
}

function versionCommand() {
    var path = require('path');
    var packagePath = path.resolve(__dirname, '../package.json');
    var packageMeta = require(packagePath);
    console.log(packageMeta.version);
}

var commandSignatures = {
    0: {
        type: 'string',
        alias: 'filename',
        params: {
            verbose: {
                type: 'boolean',
                default: false
            },
            cover: {
                type: 'boolean',
                default: false,
                params: {
                    report: {
                        params: {
                            console: {
                                type: 'boolean',
                                default: true
                            },
                            json: {
                                type: 'boolean',
                                default: false
                            },
                            html: {
                                type: 'boolean',
                                default: false
                            }
                        }
                    },
                    upload: {
                        params: {
                            codecov: {
                                type: 'boolean',
                                default: false,
                                params: {
                                    token: {
                                        type: 'string'
                                    }
                                }
                            }
                        }
                    }
                }
            },
            test: {
                type: 'boolean',
                default: false,
                params: {
                    output: {
                        type: 'array',
                        enum: ['console', 'json'],
                        default: ['console']
                    }
                }
            }
        },
        fn: startCommand
    },
    version: {
        type: 'boolean',
        default: false,
        fn: versionCommand
    },
    usage: {
        default: true,
        fn: function() {
            console.log('usage jsenv <path>');
        }
    }
};

var commandApi = commandAPI(commandSignatures);
commandApi.exec(process.argv.slice(2));
